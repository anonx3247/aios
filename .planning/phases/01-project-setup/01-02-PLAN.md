---
phase: 01-project-setup
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - apps/backend/package.json
  - apps/backend/tsconfig.json
  - apps/backend/src/index.ts
  - packages/shared/package.json
  - packages/shared/tsconfig.json
  - packages/shared/src/index.ts
  - packages/typescript-config/package.json
  - packages/typescript-config/base.json
  - packages/typescript-config/react.json
  - packages/typescript-config/node.json
  - eslint.config.js
  - tsconfig.json
  - package.json
autonomous: true

must_haves:
  truths:
    - "Hono backend starts and responds to health check (curl localhost:3001/health returns 200)"
    - "TypeScript compilation works across all packages (pnpm typecheck passes)"
    - "ESLint runs without config errors (pnpm lint does not crash)"
    - "Shared package is importable from both desktop and backend"
  artifacts:
    - path: "apps/backend/src/index.ts"
      provides: "Hono server entry point"
      contains: "serve"
    - path: "packages/shared/src/index.ts"
      provides: "Shared type exports"
    - path: "packages/typescript-config/base.json"
      provides: "Base TypeScript configuration"
      contains: "strict"
    - path: "eslint.config.js"
      provides: "ESLint flat config for workspace"
      contains: "eslint"
    - path: "tsconfig.json"
      provides: "Root project references"
      contains: "references"
  key_links:
    - from: "apps/backend/package.json"
      to: "packages/shared"
      via: "workspace:* dependency"
      pattern: "@aios/shared.*workspace"
    - from: "apps/desktop/package.json"
      to: "packages/shared"
      via: "workspace:* dependency"
      pattern: "@aios/shared.*workspace"
    - from: "apps/backend/tsconfig.json"
      to: "packages/typescript-config/node.json"
      via: "tsconfig extends"
      pattern: "@aios/typescript-config/node"
---

<objective>
Add the Node.js backend (Hono), shared packages, TypeScript project configuration, and ESLint to complete the monorepo structure.

Purpose: Complete the three-layer architecture (frontend + backend + shared) with proper TypeScript and linting so all subsequent phases can build on a working foundation.
Output: Working Hono server, shared package, TypeScript configs, and ESLint flat config across the workspace.
</objective>

<execution_context>
@/Users/neosapien/.claude/get-shit-done/workflows/execute-plan.md
@/Users/neosapien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-project-setup/01-RESEARCH.md
@.planning/phases/01-project-setup/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared packages and TypeScript configuration</name>
  <files>
    packages/typescript-config/package.json
    packages/typescript-config/base.json
    packages/typescript-config/react.json
    packages/typescript-config/node.json
    packages/shared/package.json
    packages/shared/tsconfig.json
    packages/shared/src/index.ts
    tsconfig.json
  </files>
  <action>
1. **packages/typescript-config/package.json**:
   ```json
   {
     "name": "@aios/typescript-config",
     "private": true,
     "version": "0.0.0"
   }
   ```

2. **packages/typescript-config/base.json** - Strict TypeScript base:
   - strict: true, esModuleInterop: true, skipLibCheck: true
   - target: ES2022, module: ESNext, moduleResolution: bundler
   - resolveJsonModule: true, isolatedModules: true
   - declaration: true, declarationMap: true, sourceMap: true

3. **packages/typescript-config/react.json** - Extends base, adds:
   - jsx: react-jsx, lib: ["DOM", "DOM.Iterable", "ESNext"]

4. **packages/typescript-config/node.json** - Extends base, adds:
   - module: Node16, moduleResolution: Node16 (for Node.js native ESM)
   - Or keep bundler if using tsx for dev. Use Node16 for proper Node.js semantics.

5. **packages/shared/package.json**:
   ```json
   {
     "name": "@aios/shared",
     "private": true,
     "version": "0.0.0",
     "type": "module",
     "main": "./src/index.ts",
     "types": "./src/index.ts",
     "exports": {
       ".": "./src/index.ts"
     },
     "devDependencies": {
       "@aios/typescript-config": "workspace:*",
       "typescript": "^5.7"
     }
   }
   ```

6. **packages/shared/tsconfig.json** - Extends @aios/typescript-config/base.json, include src/.

7. **packages/shared/src/index.ts** - Export a placeholder type and constant:
   ```typescript
   export const APP_NAME = "AIOS" as const;
   export type AppName = typeof APP_NAME;
   ```

8. **tsconfig.json** (workspace root) - Project references pointing to all packages:
   ```json
   {
     "files": [],
     "references": [
       { "path": "./apps/desktop" },
       { "path": "./apps/backend" },
       { "path": "./packages/shared" }
     ]
   }
   ```

9. Update **apps/desktop/package.json** to add dependency on `"@aios/shared": "workspace:*"`.

10. Update **apps/desktop/tsconfig.json** to extend `@aios/typescript-config/react.json` and add `@aios/typescript-config` as devDependency. Add reference to `../../packages/shared`.

Run `pnpm install` after creating all files.
  </action>
  <verify>
    - `pnpm install` succeeds
    - `pnpm --filter @aios/shared exec tsc --noEmit` passes
    - `cat packages/shared/src/index.ts` has exports
  </verify>
  <done>TypeScript config packages exist. Shared package exports types. All packages resolve via workspace protocol.</done>
</task>

<task type="auto">
  <name>Task 2: Create Hono backend and ESLint config</name>
  <files>
    apps/backend/package.json
    apps/backend/tsconfig.json
    apps/backend/src/index.ts
    eslint.config.js
    package.json
  </files>
  <action>
1. **apps/backend/package.json**:
   ```json
   {
     "name": "@aios/backend",
     "private": true,
     "version": "0.1.0",
     "type": "module",
     "scripts": {
       "dev": "tsx watch src/index.ts",
       "build": "tsc",
       "start": "node dist/index.js"
     },
     "dependencies": {
       "@aios/shared": "workspace:*",
       "hono": "^4",
       "@hono/node-server": "^1"
     },
     "devDependencies": {
       "@aios/typescript-config": "workspace:*",
       "tsx": "^4",
       "typescript": "^5.7",
       "@types/node": "^22"
     }
   }
   ```

2. **apps/backend/tsconfig.json** - Extends @aios/typescript-config/node.json:
   - outDir: ./dist, rootDir: ./src
   - Include src/, reference ../../packages/shared

3. **apps/backend/src/index.ts**:
   ```typescript
   import { serve } from "@hono/node-server";
   import { Hono } from "hono";
   import { APP_NAME } from "@aios/shared";

   const app = new Hono();

   app.get("/health", (c) => c.json({ status: "ok", app: APP_NAME }));

   const port = Number(process.env.PORT) || 3001;

   serve({ fetch: app.fetch, port }, (info) => {
     console.log(`${APP_NAME} backend running on http://localhost:${info.port}`);
   });

   export type AppType = typeof app;
   ```

4. **eslint.config.js** - ESLint 9 flat config:
   ```javascript
   import js from "@eslint/js";
   import tseslint from "typescript-eslint";

   export default tseslint.config(
     js.configs.recommended,
     ...tseslint.configs.recommended,
     {
       ignores: ["**/dist/**", "**/node_modules/**", "**/src-tauri/**"],
     }
   );
   ```

5. Update root **package.json** devDependencies to add:
   - `eslint`: "^9"
   - `@eslint/js`: "^9"
   - `typescript-eslint`: "^8"
   - `typescript`: "^5.7"

6. Run `pnpm install` then verify:
   - `pnpm --filter @aios/backend dev` starts server (test with curl, then kill)
   - `pnpm lint` runs without config errors

7. Verify the shared package import works in backend by checking that the health endpoint returns APP_NAME.
  </action>
  <verify>
    - `pnpm install` succeeds
    - `pnpm --filter @aios/backend dev &` then `curl http://localhost:3001/health` returns `{"status":"ok","app":"AIOS"}`; kill the background process
    - `pnpm lint` exits without config errors (warnings OK)
    - `pnpm typecheck` runs TypeScript project references build
  </verify>
  <done>Hono backend starts and serves health endpoint using shared package. ESLint flat config works across workspace. TypeScript type-checking works via project references.</done>
</task>

</tasks>

<verification>
Run these checks to verify the plan succeeded:

1. `pnpm install` - exits 0
2. `pnpm --filter @aios/backend dev` - starts Hono server on port 3001
3. `curl http://localhost:3001/health` - returns JSON with status ok and app AIOS
4. `pnpm lint` - ESLint runs without config errors
5. `pnpm typecheck` - TypeScript compiles all packages
6. Shared package import works (backend uses APP_NAME from @aios/shared)
</verification>

<success_criteria>
- All four workspace packages exist (@aios/desktop, @aios/backend, @aios/shared, @aios/typescript-config)
- Hono server starts and responds to health check
- TypeScript compilation succeeds across all packages
- ESLint flat config works
- Shared package is consumed by both desktop and backend
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-setup/01-02-SUMMARY.md`
</output>
